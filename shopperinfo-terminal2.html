<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Adyen Total Donated</title>
        <link rel="stylesheet" href="/style.css">  
    </head>
    <body>
        <div class="container">
            <button id="btn" onclick="getshopperReference()">Check my donations<br><br>PRESS HERE!</button>
            <button id="back-btn" onclick="pagerefresh()" style="display: none;">Go back</button>
            <h1 id="loading">Tap your wristband...</h1>
            <button id="refresh-btn" onclick="getshopperReference()">refresh</button>
            <h1 id="shopper-info"></h1>
            <button id="home-screen-btn" onclick="pagerefresh()">Home screen</button>
        </div>
        <div class="fixed">Terminal 2</div>
        
       

    </body> 
    <script>
        const button = document.getElementById("btn")
        const loading = document.getElementById("loading")
        const shopperInfo = document.getElementById("shopper-info")
        const homeBtn = document.getElementById("home-screen-btn")
        const backBtn = document.getElementById("back-btn")


        async function getshopperReference() {
            button.style.display = "none";
            backBtn.style.display = "block";
            homeBtn.style.display = "none";
            loading.style.display = "block";

            const total = await fetch('./api/shopper-info',{
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({"terminalSerial":"V400m-346510902"}),
            })
            .then(
                function(response) {
                    if (response.status !== 200) {
                        console.log('Looks like there was a problem. Status Code: ' +
                        response.status);
                        return;
                    }
                    response.json().then(function(data) {
                    
                    let numberOfPurchases = data?.numberOfPurchases || null
                    let transactionsTotal = data?.transactionsTotal || null
                    
                    let text;
                    if(numberOfPurchases){
                        text = `Thank you

                        You made ${numberOfPurchases} purchases at the event! 

                        That's a total of ${transactionsTotal} dollars Adyen will donate to the charity!`
                    } else {
                        text = `Sorry I'm having rouble reading your wristband, please try a different one`
                    }

                    loading.style.display = "none";
                    shopperInfo.innerText = text
                    shopperInfo.style.display = "block";
                    homeBtn.style.display = "block"
                    backBtn.style.display = "none"
                    console.log(data)
                    });
                }
            )         
         }    
         
         function pagerefresh() {
            window.location.reload();
         }
    </script> 
</html>